#Variables Start

    $ErrorActionPreference = 'SilentlyContinue'
    $ProgressPreference = 'SilentlyContinue'

    $ScriptName       = 'RTDiagnostic'
    $ScriptVers       = '0.1'

    $DirBse = $Env:SystemDrive+'\RTSupport'    # Base working Directory

    $LogName = ((Get-Date -UFormat "%Y.%m.%d_%R") -replace '[:]')+'_'+$env:COMPUTERNAME+'_'+$ScriptNme+'_v'+$ScriptVer
        $LogTmp = $DirBse+'\'+$LogName+'.tmp'
        $LogTxt = $DirBse+'\'+$LogName+'.log'

# Variables End

# Functions Start
    # Most functions that don't require security are stored in a Github public repo
    $gURL = 'https://raw.githubusercontent.com/RelayTechIT/RTDiag/main/'
    iwr -useb "$gURL`RTDiagFunctions" | iex
# Functions End

# Script Start

# Begin the script transcript to the logfile
Start-Transcript $LogTxt

# Menu


function _ShowMenu {
    $Steps = ("SystemUptime", "WindowsTime", "ChocoUpdate", "WinUpdate", "ActiveBackupCheck", "DiskCleanup", "DiskChecks")
    $n = 1
    $count = ($Steps.count)

        $Output =   @()
        $Output +=  "Relay Tech Diagnostic version:"+$ScriptVers
        $Output +=  ""
        $Output +=  "Select an option to continue:"
    $steps | foreach {
        $Output +=  "   "+$n+"  -   "+$_
        $n++
    }
        $Output +=  ""
        $Output +=  "   99  -   End Script"
        $Output +=  ""
}

While (1) {
    Switch (_ShowMenu) {
        1 {$v='SystemUptime';iwr -useb $gURL$v | iex}
        2 {$v='WindowsTime';iwr -useb $gURL$v | iex}
        3 {$v='ChocoUpdate';iwr -useb $gURL$v | iex}
        4 {$v='WinUpdate';iwr -useb $gURL$v | iex}
        5 {$v='ActiveBackupCheck';iwr -useb $gURL$v | iex}
        6 {$v='DiskCleanup';iwr -useb $gURL$v | iex}
        7 {$v='DiskChecks';iwr -useb $gURL$v | iex}
        99 {Break;}
        Default {Write-Host "Incorrect Selection. Pick again."}
    }
}

# Stop writing to the log file
Stop-Transcript
